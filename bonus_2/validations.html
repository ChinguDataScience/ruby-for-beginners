<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Ruby for Beginners">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="BEd2YAbpSQrRqU2-5wUifTTzvqTMGLLE269b0JZTfCs" />

    <title>Bonus: Validations | Ruby for Beginners</title>

    <link href="../assets/stylesheets/monstas-8ef2dc26.css" rel="stylesheet" type="text/css" />
  </head>

  <body>
    <nav class="page-nav"><a class="prev" href="/bonus_2/sessions.html">
  Previous
</a></nav>
    <nav class="page-nav"><a class="next" href="/bonus_2/resources.html">
  Next
</a></nav>

    <div>
      <nav class="toc">
        <h1>Contents</h1>
        <ul>
  <li>
    <a href="/index.html">
      Ruby For Beginners
    </a>
  </li>
  <li>
    <a href="/preface.html">
      Preface
    </a>
  </li>
  <li>
    <a href="/creation.html">
      Programming is creation
    </a>
  </li>
  <li class="directory">
    <a href="/learning_to_program.html">
      Learning to program
    </a>
    <ul>
      <li>
        <a href="/learning_to_program/learning_modes.html">
          Learning modes
        </a>
      </li>
      <li>
        <a href="/learning_to_program/dont_believe.html">
          Don&rsquo;t believe everything we say
        </a>
      </li>
      <li>
        <a href="/learning_to_program/formatting_code.html">
          Formatting your code
        </a>
      </li>
      <li>
        <a href="/learning_to_program/error_messages.html">
          Reading error messages
        </a>
      </li>
      <li>
        <a href="/learning_to_program/using_google.html">
          Using Google
        </a>
      </li>
    </ul>
  </li>
  <li class="directory">
    <a href="/your_tools.html">
      Your tools
    </a>
    <ul>
      <li>
        <a href="/your_tools/text_editor.html">
          Text Editor
        </a>
      </li>
      <li>
        <a href="/your_tools/terminal.html">
          Terminal
        </a>
      </li>
      <li>
        <a href="/your_tools/ruby_runtime.html">
          Ruby runtime
        </a>
      </li>
      <li>
        <a href="/your_tools/workflow.html">
          Programming workflow
        </a>
      </li>
      <li>
        <a href="/your_tools/irb.html">
          Interactive Ruby
        </a>
      </li>
    </ul>
  </li>
  <li>
    <a href="/object_oriented_programming.html">
      Object-oriented programming
    </a>
  </li>
  <li class="directory">
    <a href="/built_in_classes.html">
      Built-in classes
    </a>
    <ul>
      <li>
        <a href="/built_in_classes/numbers.html">
          Numbers
        </a>
      </li>
      <li>
        <a href="/built_in_classes/strings.html">
          Strings
        </a>
      </li>
      <li>
        <a href="/built_in_classes/symbols.html">
          Symbols
        </a>
      </li>
      <li>
        <a href="/built_in_classes/arrays.html">
          Arrays
        </a>
      </li>
      <li>
        <a href="/built_in_classes/hashes.html">
          Hashes
        </a>
      </li>
    </ul>
  </li>
  <li>
    <a href="/variables.html">
      Variables
    </a>
  </li>
  <li class="directory">
    <a href="/methods.html">
      Methods
    </a>
    <ul>
      <li>
        <a href="/methods/return_values.html">
          Return values
        </a>
      </li>
      <li>
        <a href="/methods/parentheses.html">
          Parentheses
        </a>
      </li>
      <li>
        <a href="/methods/writing_methods.html">
          Writing a new method
        </a>
      </li>
      <li>
        <a href="/methods/control_flow.html">
          Flow of execution
        </a>
      </li>
      <li>
        <a href="/methods/scopes.html">
          Scopes
        </a>
      </li>
      <li>
        <a href="/methods/printing.html">
          Printing things
        </a>
      </li>
    </ul>
  </li>
  <li class="directory">
    <a href="/everything_an_object.html">
      Everything is an object
    </a>
    <ul>
      <li>
        <a href="/everything_an_object/object_classes.html">
          Objects have classes
        </a>
      </li>
      <li>
        <a href="/everything_an_object/object_methods.html">
          Calling methods
        </a>
      </li>
    </ul>
  </li>
  <li>
    <a href="/string_interpolation.html">
      String interpolation
    </a>
  </li>
  <li>
    <a href="/nothing_and_truth.html">
      Nothingness and the truth
    </a>
  </li>
  <li class="directory">
    <a href="/blocks.html">
      Blocks
    </a>
    <ul>
      <li>
        <a href="/blocks/block_syntax.html">
          Alternative block syntaxes
        </a>
      </li>
      <li>
        <a href="/blocks/block_arguments.html">
          Block arguments
        </a>
      </li>
      <li>
        <a href="/blocks/block_return_values.html">
          Block return values
        </a>
      </li>
    </ul>
  </li>
  <li class="directory">
    <a href="/bonus_1.html">
      Bonus: Methods &amp; Operators
    </a>
    <ul>
      <li>
        <a href="/bonus_1/operator_methods.html">
          Operators are methods
        </a>
      </li>
      <li>
        <a href="/bonus_1/predicate_methods.html">
          Predicate methods
        </a>
      </li>
      <li>
        <a href="/bonus_1/other_methods.html">
          Lots of other methods
        </a>
      </li>
      <li>
        <a href="/bonus_1/questions_commands.html">
          Questions and commands
        </a>
      </li>
      <li>
        <a href="/bonus_1/conditionals.html">
          Conditionals
        </a>
      </li>
      <li>
        <a href="/bonus_1/operators.html">
          Operators
        </a>
      </li>
      <li>
        <a href="/bonus_1/arithmetical_operators.html">
          Arithmetical operators
        </a>
      </li>
      <li>
        <a href="/bonus_1/logical_operators.html">
          Logical operators
        </a>
      </li>
      <li>
        <a href="/bonus_1/comparison_operators.html">
          Comparison operators
        </a>
      </li>
      <li>
        <a href="/bonus_1/alternative-syntax.html">
          Alternative Syntax
        </a>
      </li>
    </ul>
  </li>
  <li class="directory">
    <a href="/writing_classes.html">
      Writing classes
    </a>
    <ul>
      <li>
        <a href="/writing_classes/initializing_objects.html">
          Initializing objects
        </a>
      </li>
      <li>
        <a href="/writing_classes/instance_variables.html">
          Instance variables
        </a>
      </li>
      <li>
        <a href="/writing_classes/attribute_readers.html">
          Attribute readers
        </a>
      </li>
      <li>
        <a href="/writing_classes/attribute_writers.html">
          Attribute writers
        </a>
      </li>
      <li>
        <a href="/writing_classes/state_and_behaviour.html">
          State and behaviour
        </a>
      </li>
    </ul>
  </li>
  <li>
    <a href="/good_names.html">
      Using the right words
    </a>
  </li>
  <li class="directory expanded">
    <a href="/bonus_2.html">
      Bonus: Advanced Topics
    </a>
    <ul>
      <li>
        <a href="/bonus_2/libraries.html">
          Bonus: Using Libraries (1)
        </a>
      </li>
      <li>
        <a href="/bonus_2/modules.html">
          Bonus: Modules
        </a>
      </li>
      <li>
        <a href="/bonus_2/private_methods.html">
          Bonus: Private methods
        </a>
      </li>
      <li>
        <a href="/bonus_2/libraries_2.html">
          Bonus: Using Libraries (2)
        </a>
      </li>
      <li>
        <a href="/bonus_2/html.html">
          Bonus: HTML
        </a>
      </li>
      <li>
        <a href="/bonus_2/erb.html">
          Bonus: Embedded Ruby
        </a>
      </li>
      <li>
        <a href="/bonus_2/http.html">
          Bonus: HTTP
        </a>
      </li>
      <li>
        <a href="/bonus_2/rack.html">
          Bonus: Rack
        </a>
      </li>
      <li>
        <a href="/bonus_2/sinatra.html">
          Bonus: Sinatra
        </a>
      </li>
      <li>
        <a href="/bonus_2/forms.html">
          Bonus: Forms
        </a>
      </li>
      <li>
        <a href="/bonus_2/storing_data.html">
          Bonus: Storing data
        </a>
      </li>
      <li>
        <a href="/bonus_2/sessions.html">
          Bonus: Sessions
        </a>
      </li>
      <li class="active">
        <a href="/bonus_2/validations.html">
          Bonus: Validations
        </a>
      </li>
      <li>
        <a href="/bonus_2/resources.html">
          Bonus: Resources
        </a>
      </li>
    </ul>
  </li>
  <li class="directory">
    <a href="/exercises.html">
      Exercises
    </a>
    <ul>
      <li>
        <a href="/exercises/numbers.html">
          Working with Numbers
        </a>
      </li>
      <li>
        <a href="/exercises/strings.html">
          Working with Strings
        </a>
      </li>
      <li>
        <a href="/exercises/arrays_1.html">
          Working with Arrays (1)
        </a>
      </li>
      <li>
        <a href="/exercises/hashes_1.html">
          Working with Hashes (1)
        </a>
      </li>
      <li>
        <a href="/exercises/methods_1.html">
          Defining methods
        </a>
      </li>
      <li>
        <a href="/exercises/arrays_2.html">
          Working with Arrays (2)
        </a>
      </li>
      <li>
        <a href="/exercises/nested_arrays.html">
          Working with Nested Arrays
        </a>
      </li>
      <li>
        <a href="/exercises/hashes_2.html">
          Working with Hashes (2)
        </a>
      </li>
      <li>
        <a href="/exercises/truthiness.html">
          Truthiness
        </a>
      </li>
      <li>
        <a href="/exercises/email.html">
          The Email Class
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox.html">
          The Mailbox Class
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox_text.html">
          The Mailbox Text Formatter
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox_html.html">
          The Mailbox Html Formatter
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox_file.html">
          Storing our HTML to a File
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox_csv.html">
          Reading from a CSV File
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox_erb.html">
          Generating HTML using ERB
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox_sinatra.html">
          Serving HTML using Sinatra
        </a>
      </li>
      <li>
        <a href="/exercises/rubygems.html">
          Using Rubygems
        </a>
      </li>
      <li>
        <a href="/exercises/bundler.html">
          Using Bundler
        </a>
      </li>
    </ul>
  </li>
</ul>
      </nav>
      <article>
        <nav class="menu"><a href="#"></a></nav>
        <h1>Bonus: Validations</h1>

<p>Our little application now already makes use of a bunch of things that you will
regularly find in web applications.</p>

<p>We have a form that posts to another route. The <code>post</code> route picks up the data,
and stores it, then redirects to another route, which displays the data. We also
use a session, and a query parameter to pass data from one route to another.</p>

<p>However, we still are a little naive in accepting whatever data comes in to our
<code>post</code> route: Do we want to store duplicate names? What if the same name is
being submitted over and over again? And what if there&rsquo;s no name submitted at
all?</p>

<p>What we really want to do is validate the incoming data (name), and only accept
and store it when we find it&rsquo;s valid. If it&rsquo;s not, then we want to display a
message to the user, and ask them to submit the form again.</p>

<p>We could change our <code>post</code> route like so:</p>
<pre class="highlight ruby"><code><span class="n">post</span> <span class="s2">"/hello"</span> <span class="k">do</span>
  <span class="nb">name</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>

  <span class="k">if</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">empty?</span>
    <span class="n">session</span><span class="p">[</span><span class="ss">:message</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"You need to enter a name."</span>
  <span class="k">elsif</span> <span class="n">read_names</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="n">session</span><span class="p">[</span><span class="ss">:message</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> is already included in our list."</span>
  <span class="k">else</span>
    <span class="n">store_name</span><span class="p">(</span><span class="s2">"names.txt"</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span>
    <span class="n">session</span><span class="p">[</span><span class="ss">:message</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Successfully stored the name </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">."</span>
  <span class="k">end</span>

  <span class="n">redirect</span> <span class="s2">"/hello?name=</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre>

<p>This is a valid implementation, and if you restart your application you
can try it out.</p>

<p>The <code>if</code> statement first checks if the <code>name</code> is empty. If it is we simply
store a message to the session, and then redirect.</p>

<p>Note that we call <code>to_s</code> (&ldquo;to string&rdquo;) on the <code>name</code>. This is useful because
there might not be any value stored on <code>params[:name]</code>. In this case we&rsquo;d get
<code>nil</code>, which does not know the method <code>empty?</code>. We therefor turn a potential
<code>nil</code> value into an empty string first.  Of course, if there&rsquo;s a string stored
on <code>params[:key]</code>, then <code>to_s</code> would just return the same string.</p>

<p>The <code>if</code> statement then checks if the given <code>name</code> already is included in the
names in our file: the array returned by <code>read_names</code>. (We had implemented this
method in order use it in our <code>get</code> route for displaying all the names, and now
we can just re-use it here.) If we already have the name, then, again, we just
add a message to the session, and redirect.</p>

<p>Only in the last case, when the name is not empty, and not already known,
we do store it, and add the respective message to the session, and redirect.</p>

<p>However, it&rsquo;s worth considering that this adds quite a bit of stuff to our
route. So what if we extracted this to a validator class?</p>

<p>Let&rsquo;s implement a little Ruby class that hides some of the logic from the
route. Here&rsquo;s how we could do it:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">NameValidator</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span>
    <span class="vi">@names</span> <span class="o">=</span> <span class="n">names</span>
    <span class="vi">@messages</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">valid?</span>
    <span class="n">validate</span>
    <span class="vi">@messages</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">message</span>
    <span class="vi">@messages</span><span class="p">.</span><span class="nf">first</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">validate</span>
      <span class="k">if</span> <span class="vi">@name</span><span class="p">.</span><span class="nf">empty?</span>
        <span class="vi">@messages</span> <span class="o">&lt;&lt;</span> <span class="s2">"You need to enter a name"</span>
      <span class="k">elsif</span> <span class="vi">@names</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="vi">@name</span><span class="p">)</span>
        <span class="vi">@messages</span> <span class="o">&lt;&lt;</span> <span class="s2">"</span><span class="si">#{</span><span class="vi">@name</span><span class="si">}</span><span class="s2"> is already included in our list."</span>
      <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s2">"/hello"</span> <span class="k">do</span>
  <span class="nb">name</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
  <span class="n">validator</span> <span class="o">=</span> <span class="no">NameValidator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">read_names</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">validator</span><span class="p">.</span><span class="nf">valid?</span>
    <span class="n">store_name</span><span class="p">(</span><span class="s2">"names.txt"</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span>
    <span class="n">session</span><span class="p">[</span><span class="ss">:message</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Successfully stored the name </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">."</span>
  <span class="k">else</span>
    <span class="n">session</span><span class="p">[</span><span class="ss">:message</span><span class="p">]</span> <span class="o">=</span> <span class="n">validator</span><span class="p">.</span><span class="nf">message</span>
  <span class="k">end</span>

  <span class="n">redirect</span> <span class="s2">"/hello?name=</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre>

<p>This adds quite a bit of code that we need to figure out, and type. But it
might be worth it: Our route is now much shorter, and way easier to understand
from just a quick look at it. We could move the <code>NameValidator</code> to a separate
file.</p>

<p>So this works. However, imagine we&rsquo;d have a much bigger form, with lots of
fields. We&rsquo;d then need to pass all of these back to the <code>get</code> route by the
way of appending all of them to the URL - otherwise this data would be lost
and the user would have to re-enter it.</p>

<p>For this reason modern web applications usually follow a different pattern.</p>

<p>Instead of redirecting the user, when the submitted data is invalid, we would
just re-render the same template right away, with the same data.</p>

<p>Here&rsquo;s how we could do that:</p>
<pre class="highlight ruby"><code><span class="n">post</span> <span class="s2">"/hello"</span> <span class="k">do</span>
  <span class="vi">@name</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
  <span class="vi">@names</span> <span class="o">=</span> <span class="n">read_names</span>
  <span class="n">validator</span> <span class="o">=</span> <span class="no">NameValidator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@name</span><span class="p">,</span> <span class="vi">@names</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">validator</span><span class="p">.</span><span class="nf">valid?</span>
    <span class="n">store_name</span><span class="p">(</span><span class="s2">"names.txt"</span><span class="p">,</span> <span class="vi">@name</span><span class="p">)</span>
    <span class="n">session</span><span class="p">[</span><span class="ss">:message</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Successfully stored the name </span><span class="si">#{</span><span class="vi">@name</span><span class="si">}</span><span class="s2">."</span>
    <span class="n">redirect</span> <span class="s2">"/hello?name=</span><span class="si">#{</span><span class="vi">@name</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">else</span>
    <span class="vi">@message</span> <span class="o">=</span> <span class="n">validator</span><span class="p">.</span><span class="nf">message</span>
    <span class="n">erb</span> <span class="ss">:hello</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>As you can see we now only store a message to the session, and redirect, if
the given data was valid. If it&rsquo;s not we store the validation message to
the <code>@message</code> instance variable and render our template again.</p>

<p>Cool. If you restart your application you can try how it works.</p>

<p>However, this now displays an empty &ldquo;Hello&rdquo; at the top. Why&rsquo;s that?</p>

<p>We assign <code>params[:name]</code> to the instance variable <code>@name</code> which we then check
in our template: <code>&lt;% if @name %&gt;</code>. However, since this has been submitted by a
form, with an input element called <code>name</code>, what we get is an empty string, not
<code>nil</code>.</p>

<p>We can fix this by changing our view like so:</p>
<pre class="highlight erb"><code><span class="cp">&lt;%</span> <span class="k">unless</span> <span class="vi">@name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">empty?</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Hello <span class="cp">&lt;%=</span> <span class="vi">@name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>

<p>Awesome.</p>

<p>With this completed you have now walked through an important pattern, which
also is used in Rails applications by default:</p>

<ul>
<li>There is an HTML form which is being retrieved via a <code>GET</code> request.</li>
<li>This form posts to another route, which validates the submitted data.</li>
<li>If the data is valid, it does something with it (in our case we store it).</li>
<li>If it&rsquo;s not valid, it renders an error message, as well as the form,
with the form fields populated with the given data.</li>
</ul>

<p>Let&rsquo;s take this a step further and have a look at something that Rails
calls &ldquo;resources&rdquo;.</p>

        <nav class="page-nav"><a class="prev" href="/bonus_2/sessions.html">
  Previous
</a></nav>
        <nav class="page-nav"><a class="next" href="/bonus_2/resources.html">
  Next
</a></nav>
      </article>
    </div>

    <footer>
      <ul>
        <li><a href="http://rubymonstas.org">Ruby Monstas</a></li>
        <li><a href="mailto:ruby.monsters@gmail.com">Email</a></li>
        <li><a href="https://twitter.com/rubymonsters">Twitter</a></li>
        <li><a href="https://github.com/rubymonsters">GitHub</a></li>
        <li><a href="https://creativecommons.org/licenses/by-sa/2.0/" rel="license cc:license">License</a></li>
        <li><a href="http://foundation.travis-ci.org/imprint/">Imprint</a></li>
      </ul>
    </footer>

    <script src="../assets/javascripts/modernizr-4c875d94.js" type="text/javascript"></script>
    <script src="../assets/javascripts/monstas-e84d6217.js" type="text/javascript"></script>
  </body>
</html>
