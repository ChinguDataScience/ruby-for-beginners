<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Ruby for Beginners">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="BEd2YAbpSQrRqU2-5wUifTTzvqTMGLLE269b0JZTfCs" />

    <title>Bonus: Embedded Ruby | Ruby for Beginners</title>

    <link href="../assets/stylesheets/monstas-29ea5021.css" rel="stylesheet" type="text/css" />
  </head>

  <body>
    <nav class="page-nav"><a class="prev" href="/bonus_2/html.html">
  Previous
</a></nav>
    <nav class="page-nav"><a class="next" href="/bonus_2/http.html">
  Next
</a></nav>

    <div>
      <nav class="toc">
        <h1>Contents</h1>
        <ul>
  <li>
    <a href="/index.html">
      Ruby For Beginners
    </a>
  </li>
  <li>
    <a href="/preface.html">
      Preface
    </a>
  </li>
  <li>
    <a href="/creation.html">
      Programming is creation
    </a>
  </li>
  <li class="directory">
    <a href="/learning_to_program.html">
      Learning to program
    </a>
    <ul>
      <li>
        <a href="/learning_to_program/learning_modes.html">
          Learning modes
        </a>
      </li>
      <li>
        <a href="/learning_to_program/dont_believe.html">
          Don&rsquo;t believe everything we say
        </a>
      </li>
      <li>
        <a href="/learning_to_program/formatting_code.html">
          Formatting your code
        </a>
      </li>
      <li>
        <a href="/learning_to_program/error_messages.html">
          Reading error messages
        </a>
      </li>
      <li>
        <a href="/learning_to_program/using_google.html">
          Using Google
        </a>
      </li>
    </ul>
  </li>
  <li class="directory">
    <a href="/your_tools.html">
      Your tools
    </a>
    <ul>
      <li>
        <a href="/your_tools/text_editor.html">
          Text Editor
        </a>
      </li>
      <li>
        <a href="/your_tools/terminal.html">
          Terminal
        </a>
      </li>
      <li>
        <a href="/your_tools/ruby_runtime.html">
          Ruby runtime
        </a>
      </li>
      <li>
        <a href="/your_tools/workflow.html">
          Programming workflow
        </a>
      </li>
      <li>
        <a href="/your_tools/irb.html">
          Interactive Ruby
        </a>
      </li>
    </ul>
  </li>
  <li>
    <a href="/object_oriented_programming.html">
      Object-oriented programming
    </a>
  </li>
  <li class="directory">
    <a href="/built_in_classes.html">
      Built-in classes
    </a>
    <ul>
      <li>
        <a href="/built_in_classes/numbers.html">
          Numbers
        </a>
      </li>
      <li>
        <a href="/built_in_classes/strings.html">
          Strings
        </a>
      </li>
      <li>
        <a href="/built_in_classes/symbols.html">
          Symbols
        </a>
      </li>
      <li>
        <a href="/built_in_classes/arrays.html">
          Arrays
        </a>
      </li>
      <li>
        <a href="/built_in_classes/hashes.html">
          Hashes
        </a>
      </li>
    </ul>
  </li>
  <li>
    <a href="/variables.html">
      Variables
    </a>
  </li>
  <li class="directory">
    <a href="/methods.html">
      Methods
    </a>
    <ul>
      <li>
        <a href="/methods/return_values.html">
          Return values
        </a>
      </li>
      <li>
        <a href="/methods/parentheses.html">
          Parentheses
        </a>
      </li>
      <li>
        <a href="/methods/writing_methods.html">
          Writing a new method
        </a>
      </li>
      <li>
        <a href="/methods/control_flow.html">
          Flow of execution
        </a>
      </li>
      <li>
        <a href="/methods/scopes.html">
          Scopes
        </a>
      </li>
      <li>
        <a href="/methods/printing.html">
          Printing things
        </a>
      </li>
    </ul>
  </li>
  <li class="directory">
    <a href="/everything_an_object.html">
      Everything is an object
    </a>
    <ul>
      <li>
        <a href="/everything_an_object/object_classes.html">
          Objects have classes
        </a>
      </li>
      <li>
        <a href="/everything_an_object/object_methods.html">
          Calling methods
        </a>
      </li>
    </ul>
  </li>
  <li>
    <a href="/string_interpolation.html">
      String interpolation
    </a>
  </li>
  <li>
    <a href="/nothing_and_truth.html">
      Nothingness and the truth
    </a>
  </li>
  <li class="directory">
    <a href="/blocks.html">
      Blocks
    </a>
    <ul>
      <li>
        <a href="/blocks/block_syntax.html">
          Alternative block syntaxes
        </a>
      </li>
      <li>
        <a href="/blocks/block_arguments.html">
          Block arguments
        </a>
      </li>
      <li>
        <a href="/blocks/block_return_values.html">
          Block return values
        </a>
      </li>
    </ul>
  </li>
  <li class="directory">
    <a href="/bonus_1.html">
      Bonus: Methods &amp; Operators
    </a>
    <ul>
      <li>
        <a href="/bonus_1/operator_methods.html">
          Operators are methods
        </a>
      </li>
      <li>
        <a href="/bonus_1/predicate_methods.html">
          Predicate methods
        </a>
      </li>
      <li>
        <a href="/bonus_1/other_methods.html">
          Lots of other methods
        </a>
      </li>
      <li>
        <a href="/bonus_1/questions_commands.html">
          Questions and commands
        </a>
      </li>
      <li>
        <a href="/bonus_1/conditionals.html">
          Conditionals
        </a>
      </li>
      <li>
        <a href="/bonus_1/operators.html">
          Operators
        </a>
      </li>
      <li>
        <a href="/bonus_1/arithmetical_operators.html">
          Arithmetical operators
        </a>
      </li>
      <li>
        <a href="/bonus_1/logical_operators.html">
          Logical operators
        </a>
      </li>
      <li>
        <a href="/bonus_1/comparison_operators.html">
          Comparison operators
        </a>
      </li>
      <li>
        <a href="/bonus_1/alternative-syntax.html">
          Alternative Syntax
        </a>
      </li>
    </ul>
  </li>
  <li class="directory">
    <a href="/writing_classes.html">
      Writing classes
    </a>
    <ul>
      <li>
        <a href="/writing_classes/initializing_objects.html">
          Initializing objects
        </a>
      </li>
      <li>
        <a href="/writing_classes/instance_variables.html">
          Instance variables
        </a>
      </li>
      <li>
        <a href="/writing_classes/attribute_readers.html">
          Attribute readers
        </a>
      </li>
      <li>
        <a href="/writing_classes/attribute_writers.html">
          Attribute writers
        </a>
      </li>
      <li>
        <a href="/writing_classes/state_and_behaviour.html">
          State and behaviour
        </a>
      </li>
    </ul>
  </li>
  <li>
    <a href="/good_names.html">
      Using the right words
    </a>
  </li>
  <li class="directory expanded">
    <a href="/bonus_2.html">
      Bonus: Advanced Topics
    </a>
    <ul>
      <li>
        <a href="/bonus_2/libraries.html">
          Bonus: Using Libraries (1)
        </a>
      </li>
      <li>
        <a href="/bonus_2/modules.html">
          Bonus: Modules
        </a>
      </li>
      <li>
        <a href="/bonus_2/private_methods.html">
          Bonus: Private methods
        </a>
      </li>
      <li>
        <a href="/bonus_2/libraries_2.html">
          Bonus: Using Libraries (2)
        </a>
      </li>
      <li>
        <a href="/bonus_2/html.html">
          Bonus: HTML
        </a>
      </li>
      <li class="active">
        <a href="/bonus_2/erb.html">
          Bonus: Embedded Ruby
        </a>
      </li>
      <li>
        <a href="/bonus_2/http.html">
          Bonus: HTTP
        </a>
      </li>
      <li>
        <a href="/bonus_2/rack.html">
          Bonus: Rack
        </a>
      </li>
    </ul>
  </li>
  <li class="directory">
    <a href="/exercises.html">
      Exercises
    </a>
    <ul>
      <li>
        <a href="/exercises/numbers.html">
          Working with Numbers
        </a>
      </li>
      <li>
        <a href="/exercises/strings.html">
          Working with Strings
        </a>
      </li>
      <li>
        <a href="/exercises/arrays_1.html">
          Working with Arrays (1)
        </a>
      </li>
      <li>
        <a href="/exercises/hashes_1.html">
          Working with Hashes (1)
        </a>
      </li>
      <li>
        <a href="/exercises/methods_1.html">
          Defining methods
        </a>
      </li>
      <li>
        <a href="/exercises/arrays_2.html">
          Working with Arrays (2)
        </a>
      </li>
      <li>
        <a href="/exercises/nested_arrays.html">
          Working with Nested Arrays
        </a>
      </li>
      <li>
        <a href="/exercises/hashes_2.html">
          Working with Hashes (2)
        </a>
      </li>
      <li>
        <a href="/exercises/truthiness.html">
          Truthiness
        </a>
      </li>
      <li>
        <a href="/exercises/email.html">
          The Email Class
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox.html">
          The Mailbox Class
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox_text.html">
          The Mailbox Text Formatter
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox_html.html">
          The Mailbox Html Formatter
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox_file.html">
          Storing our HTML to a File
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox_csv.html">
          Reading from a CSV File
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox_erb.html">
          Generating HTML using ERB
        </a>
      </li>
      <li>
        <a href="/exercises/mailbox_sinatra.html">
          Serving HTML using Sinatra
        </a>
      </li>
      <li>
        <a href="/exercises/rubygems.html">
          Using Rubygems
        </a>
      </li>
      <li>
        <a href="/exercises/bundler.html">
          Using Bundler
        </a>
      </li>
    </ul>
  </li>
</ul>
      </nav>
      <article>
        <nav class="menu"><a href="#"></a></nav>
        <h1>Bonus: Embedded Ruby</h1>

<p>HTML is the main format that fuels the world wide web, i.e. the part of the
internet that we use most often.</p>

<p>Web applications are applications that run somewhere on the internet, and that
web browsers talk to. E.g. if you check your Twitter, or Facebook feed your browner
talks to the respective applications that are run by these companies.</p>

<p>Since generating HTML (so it can be send to web browsers) dynamically based on
some data (e.g. the current user&rsquo;s name, and their tweets, or emails) is the
one main concern of many web applications Ruby has some builtin support for
making this easier: a library called ERB, short for &ldquo;embedded Ruby&rdquo;.</p>

<p>The main idea behind ERB is to embed some Ruby code <em>into</em> an HTML document
(also called a template). This idea actually predates Ruby&rsquo;s ERB library and
became popular with PHP, a language that originally was meant to be used
exactly this way: by embedding some code into an HTML template file.</p>

<p>Here&rsquo;s an example:</p>
<pre class="highlight erb"><code><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Messages for <span class="cp">&lt;%=</span> <span class="nb">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="cp">&lt;%</span> <span class="n">messages</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>

<p>Can you guess what this means?</p>

<p>Everything inside the so called ERB tags <code>&lt;% ... %&gt;</code> is considered Ruby code.
Everything outside of them is just some text, in our case HTML code, into
which the results of the Ruby code will be embedded whenever the ERB tag also
has an equals sign, as in <code>&lt;%= ... %&gt;</code>.</p>

<p>Imagine stripping everything outside the ERB tags, and the tags themselves
from the code above. And imagine replacing the <code>=</code> equals sign with <code>puts</code>
statements. You&rsquo;d then end up with this code:</p>
<pre class="highlight ruby"><code><span class="nb">puts</span> <span class="nb">name</span>

<span class="n">messages</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">message</span>
<span class="k">end</span>
</code></pre>

<p>That&rsquo;s some code you understand, right? ERB, when executed, does exactly this,
except that <code>=</code> as part of the ERB tag <code>&lt;%= ... %&gt;</code> will not output things to
the terminal, but capture it, and insert it to the surounding text (HTML code,
in our case) in place of this tag.</p>

<p>Ruby code in ERB tags that do not have an equal sign, such as <code>&lt;% ... %&gt;</code> will
be executed, but the output will not be captured, but just discarded.</p>

<p>Now the above Ruby code uses two local variables, or methods with the names
<code>name</code> as well as <code>messages</code> (where <code>each</code> is called on <code>messages</code>, so this
should probably be an array).</p>

<p>So how do we provide these objects to the ERB template? And how do we execute
the whole thing?</p>

<p>It&rsquo;s probably best to look at a simple example:</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s2">"erb"</span>

<span class="n">template</span> <span class="o">=</span> <span class="sx">%(
  &lt;html&gt;
    &lt;body&gt;
      &lt;h1&gt;Messages for &lt;%= name %&gt;&lt;/h1&gt;
      &lt;ul&gt;
        &lt;% messages.each do |message| %&gt;
          &lt;li&gt;&lt;%= message %&gt;&lt;/li&gt;
        &lt;% end %&gt;
      &lt;/ul&gt;
    &lt;/body&gt;
  &lt;/html&gt;
)</span>

<span class="nb">name</span> <span class="o">=</span> <span class="s2">"Ruby Monstas"</span>
<span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">"We meet every Monday night at 7pm"</span><span class="p">,</span>
  <span class="s2">"We've almost completed the beginners course!"</span><span class="p">,</span>
  <span class="s2">"Feel free to come by and join us!"</span>
<span class="p">]</span>

<span class="n">html</span> <span class="o">=</span> <span class="no">ERB</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">template</span><span class="p">).</span><span class="nf">result</span><span class="p">(</span><span class="nb">binding</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">html</span>
</code></pre>

<p>Does this code make sense to you?</p>

<p>On the first line we require the erb from the
<a href="http://ruby-doc.org/stdlib-2.2.2/libdoc/erb/rdoc/ERB.html">Ruby Standard Library</a>.</p>

<p>Also, as you&rsquo;ve learned in <a href="/bonus_1/alternative-syntax.html">this chapter</a>
the syntax <code>%(something)</code> defines a string. So, <code>template</code> is just one, long
string that contains our HTML code including ERB tags (the same as discussed above).</p>

<p>Next we define two local variables <code>name</code> and <code>messages</code>, which hold a simple
string, as well as an array with 3 strings.</p>

<p>Now on the next line we create an instace of the class <code>ERB</code> and pass our
<code>template</code> (the string defined earlier) to it. On this instance we then call
the method <code>result</code> with something that is called <code>binding</code>.</p>

<p>This method call to <code>result</code> returns something that we assign to the variable
<code>html</code>, so, as you might guess, this should be the HTML we were after.</p>

<p>Let&rsquo;s just output it to the terminal on the last line, using <code>puts</code>.</p>

<p>If you run this code it will output something like this:</p>
<pre class="highlight html"><code><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Messages for Ruby Monstas<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span>We meet every Monday night at 7pm<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span>We've almost completed the beginners course!<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span>Feel free to come by and join us!<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>

<p>&hellip; which is a valid HTML document that a browser would render (display) like
this:</p>

<p><img src="/assets/images/erb_1-2093b8b6.png"></p>

<p>Looks good?</p>

<p>So, basically, all that our code above does is the following:</p>

<ul>
<li>Define an template with some HTML and some embedded ERB tags.</li>
<li>Define a couple variables that contain things that our template wants (<code>name</code> and <code>messages</code>).</li>
<li>Create an instance of the class ERB, passing this template.</li>
<li>On this instance, call the method <code>result</code>.</li>
</ul>

<p>This executes (we say &ldquo;renders&rdquo;) the ERB template using the <code>name</code> and
<code>messages</code> objects, and returns the HTML as a result.</p>

<p>Now, what&rsquo;s this <code>binding</code> thing? Obviously we do not define a local variable,
so it needs to be a method.</p>

<p>Let&rsquo;s google that: <a href="">Ruby binding</a></p>

<p>The first result goes to the <a
href="http://ruby-doc.org/core-2.2.0/Binding.html">Ruby documentation</a>,
saying (some rather cryptic stuff stripped for our purpose):</p>

<p><em>&ldquo;Objects of class Binding encapsulate the execution context at some particular
place in the code and retain this context for future use. The variables,
methods, [&hellip;] that can be accessed in this context are all retained. Binding
objects can be created using Kernel#binding [&hellip;]. These binding objects can be
passed [around].&rdquo;</em></p>

<p>Hmmmmm, let&rsquo;s re-read that, and think about it.</p>

<p>First of all, <a href="http://ruby-doc.org/core-2.2.2/Kernel.html">Kernel</a>
is something we have never mentioned so far. It is a
<a href="/bonus_2/modules">Ruby module</a> that is included to each and every
object in Ruby: whenever you create any object, this module, and thus all of
its methods will be included. This is the secret reason to why methods like
<code>p</code>, <code>puts</code>, and so on are available everywhere, and it is also the reason
why we do not have to define the method <code>binding</code>. It&rsquo;s just already there.</p>

<p>Now, what&rsquo;s this execution context the documentation is talking about?</p>

<p>Remember when we talked about <a href="/methods/scopes.html">scopes</a> in the
context of methods? That&rsquo;s the same as the Ruby documentation means by
&ldquo;execution context&rdquo;.  It is that empty room or space that Ruby enters whenever
it starts your program, or enters a method. If you define a <em>local</em> variable,
then this variable will be visible within this scope, or room, but not outside
of it.</p>

<p>Now the <code>binding</code> is exactly <em>this knowledge</em>: which variables are defined,
and what objects they are referring to. And the <code>binding</code> itself is an object
that can be passed around.</p>

<p>If you find this puzzling and confusing don&rsquo;t worry. This is, seriously, a
piece of knowledge few Ruby programmers know about, or at least they very
rarely use this themselves. Putting very advanced programming techniques
(called &ldquo;meta programming&rdquo;) aside rendering ERB templates is the one single use
case where you ever need it. (And, on top of this, as a developer who builds
Sinatra or Rails applications you also never use it yourself because both
Sinatra and Rails ship with tools that hide this weird stuff from you).</p>

<p>For now, the one thing you can remember is that, by calling <code>binding</code> and
passing the result to the ERB instance, you simply pass <em>access</em> to the
two local variables <code>name</code> and <code>messages</code>, so they can be used inside your
ERB template.</p>

<p>Does this make sense?</p>

<p>Then maybe it&rsquo;s a good time for an
<a href="/exercises/mailbox_erb.html">exercise on ERB</a>.</p>

        <nav class="page-nav"><a class="prev" href="/bonus_2/html.html">
  Previous
</a></nav>
        <nav class="page-nav"><a class="next" href="/bonus_2/http.html">
  Next
</a></nav>
      </article>
    </div>

    <footer>
      <ul>
        <li><a href="http://rubymonstas.org">Ruby Monstas</a></li>
        <li><a href="mailto:ruby.monsters@gmail.com">Email</a></li>
        <li><a href="https://twitter.com/rubymonsters">Twitter</a></li>
        <li><a href="https://github.com/rubymonsters">GitHub</a></li>
        <li><a href="https://creativecommons.org/licenses/by-sa/2.0/" rel="license cc:license">License</a></li>
        <li><a href="http://foundation.travis-ci.org/imprint/">Imprint</a></li>
      </ul>
    </footer>

    <script src="../assets/javascripts/modernizr-4c875d94.js" type="text/javascript"></script>
    <script src="../assets/javascripts/monstas-e84d6217.js" type="text/javascript"></script>
  </body>
</html>
